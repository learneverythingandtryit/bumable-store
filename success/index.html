<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Confirmation - BUMABLE</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .success-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 120px 20px 60px;
            text-align: center;
        }

        .success-icon {
            font-size: 5rem;
            color: #28a745;
            margin-bottom: 30px;
        }

        .success-title {
            font-size: 2.5rem;
            color: #333;
            margin-bottom: 20px;
        }

        .success-message {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 40px;
            line-height: 1.6;
        }

        .order-details {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 40px;
            text-align: left;
        }

        .order-details h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .detail-row:last-child {
            border-bottom: none;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .order-items {
            margin: 20px 0;
        }

        .order-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .order-item img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            margin-right: 15px;
        }

        .item-info {
            flex: 1;
        }

        .item-info h4 {
            margin: 0 0 5px 0;
            color: #333;
        }

        .item-info p {
            margin: 0;
            color: #666;
            font-size: 0.9rem;
        }

        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-action {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
            transform: translateY(-2px);
        }

        .delivery-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 30px 0;
        }

        .delivery-info h4 {
            color: #333;
            margin-bottom: 15px;
        }

        .delivery-timeline {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .timeline-step {
            text-align: center;
            flex: 1;
            position: relative;
        }

        .timeline-step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 20px;
            right: -50%;
            width: 100%;
            height: 2px;
            background: #ddd;
            z-index: -1;
        }

        .timeline-step.active::after {
            background: #28a745;
        }

        .timeline-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #ddd;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
        }

        .timeline-step.active .timeline-icon {
            background: #28a745;
        }

        @media (max-width: 768px) {
            .success-container {
                padding: 100px 15px 40px;
            }

            .success-title {
                font-size: 2rem;
            }

            .order-details {
                padding: 20px;
            }

            .action-buttons {
                flex-direction: column;
                align-items: center;
            }

            .delivery-timeline {
                flex-direction: column;
                gap: 20px;
            }

            .timeline-step:not(:last-child)::after {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="navbar">
            <div class="container">
                <div class="nav-brand">
                    <h1 class="logo">BUMABLE</h1>
                </div>
                
                <div class="nav-menu" id="nav-menu">
                    <ul class="nav-list">
                        <li><a href="../" class="nav-link">Home</a></li>
                        <li><a href="../shop/" class="nav-link">Shop</a></li>
                        <li><a href="../#about" class="nav-link">Our Story</a></li>
                        <li><a href="../#contact" class="nav-link">Contact Us</a></li>
                    </ul>
                </div>
                
                <div class="nav-actions">
                    <button class="btn-notifications" id="notifications-btn" onclick="toggleNotifications()" title="Notifications">
                        <i class="fas fa-bell"></i>
                        <span class="notification-count" id="notification-count" style="display: none;">0</span>
                    </button>
                    <button class="btn-cart" onclick="toggleCart()">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count">0</span>
                    </button>
                    <button class="nav-toggle" id="nav-toggle">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Success Container -->
    <div class="success-container">
        <div class="success-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        
        <h1 class="success-title">Order Confirmed!</h1>
        
        <p class="success-message">
            Thank you for your purchase! Your order has been successfully placed and is being processed. 
            You will receive a confirmation email shortly with your order details and tracking information.
        </p>

        <!-- Order Details -->
        <div class="order-details">
            <h3>Order Summary</h3>
            
            <div class="detail-row">
                <span>Order ID:</span>
                <strong id="order-id">Loading...</strong>
            </div>
            
            <div class="detail-row">
                <span>Order Date:</span>
                <span id="order-date">Loading...</span>
            </div>
            
            <div class="detail-row">
                <span>Payment Method:</span>
                <span id="payment-method">Loading...</span>
            </div>

            <div class="order-items" id="order-items">
                <!-- Order items will be loaded here -->
            </div>

            <div class="detail-row">
                <span>Subtotal:</span>
                <span id="order-subtotal">₹0</span>
            </div>
            
            <div class="detail-row">
                <span>Tax (GST 18%):</span>
                <span id="order-tax">₹0</span>
            </div>
            
            <div class="detail-row">
                <span>Shipping:</span>
                <span id="order-shipping">₹0</span>
            </div>
            
            <div class="detail-row">
                <span>Total Amount:</span>
                <strong id="order-total">₹0</strong>
            </div>
        </div>

        <!-- Delivery Information -->
        <div class="delivery-info">
            <h4><i class="fas fa-truck"></i> Delivery Information</h4>
            <p><strong>Estimated Delivery:</strong> <span id="delivery-date">3-5 business days</span></p>
            <p><strong>Delivery Address:</strong></p>
            <div id="delivery-address">Loading...</div>
            
            <div class="delivery-timeline">
                <div class="timeline-step active">
                    <div class="timeline-icon">
                        <i class="fas fa-check"></i>
                    </div>
                    <div>Order Placed</div>
                </div>
                <div class="timeline-step">
                    <div class="timeline-icon">
                        <i class="fas fa-box"></i>
                    </div>
                    <div>Processing</div>
                </div>
                <div class="timeline-step">
                    <div class="timeline-icon">
                        <i class="fas fa-truck"></i>
                    </div>
                    <div>Shipped</div>
                </div>
                <div class="timeline-step">
                    <div class="timeline-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <div>Delivered</div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <a href="../shop/" class="btn-action btn-primary">
                <i class="fas fa-shopping-bag"></i> Continue Shopping
            </a>
            <button onclick="printOrderSummary()" class="btn-action btn-success">
                <i class="fas fa-print"></i> Print Order
            </button>
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div id="cart-sidebar" class="cart-sidebar">
        <div class="cart-header">
            <h3>Shopping Cart</h3>
            <button class="cart-close" onclick="toggleCart()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="cart-content">
            <div id="cart-items" class="cart-items">
                <!-- Cart items will be loaded here -->
            </div>
        </div>
        <div id="cart-footer" class="cart-footer">
            <!-- Cart footer will be loaded here -->
        </div>
    </div>

    <!-- Cart Overlay -->
    <div id="cart-overlay" class="cart-overlay" onclick="toggleCart()"></div>

    <!-- Scripts -->
    <script src="../js/cart.js?v=20251201i"></script>
    <script src="../js/products.js?v=20251201i"></script>
    <script src="../js/main.js?v=20251201i"></script>
    
    <script>
        // Load order details from localStorage
        document.addEventListener('DOMContentLoaded', function() {
            loadOrderDetails();
            calculateDeliveryDate();
        });

        function loadOrderDetails() {
            // Get the most recent order from localStorage
            const recentOrder = localStorage.getItem('bumableRecentOrder');
            
            if (!recentOrder) {
                // Fallback to checkout data if recent order not found
                const checkoutData = localStorage.getItem('checkoutCart');
                if (checkoutData) {
                    const data = JSON.parse(checkoutData);
                    displayOrderDetails(data);
                } else {
                    // Redirect to shop if no order data
                    window.location.href = 'shop.html';
                }
                return;
            }

            const orderData = JSON.parse(recentOrder);
            displayOrderDetails(orderData);
        }

        function displayOrderDetails(orderData) {
            // Display order ID and date
            document.getElementById('order-id').textContent = orderData.orderId || 'BUM' + Date.now();
            document.getElementById('order-date').textContent = new Date(orderData.orderDate || Date.now()).toLocaleDateString('en-IN');
            document.getElementById('payment-method').textContent = orderData.payment || 'Cash on Delivery';

            // Display order items
            const orderItemsContainer = document.getElementById('order-items');
            let itemsHTML = '';
            
            if (orderData.items && orderData.items.length > 0) {
                itemsHTML = orderData.items.map(item => `
                    <div class="order-item">
                        <img src="${item.image || '../images/placeholder.jpg'}" alt="${item.name}">
                        <div class="item-info">
                            <h4>${item.name}</h4>
                            <p>Size: ${item.size || 'M'} | Qty: ${item.quantity} × ₹${item.price.toLocaleString('en-IN')}</p>
                        </div>
                        <div class="item-total">
                            <strong>₹${(item.price * item.quantity).toLocaleString('en-IN')}</strong>
                        </div>
                    </div>
                `).join('');
            }
            
            orderItemsContainer.innerHTML = itemsHTML;

            // Calculate and display totals
            const subtotal = orderData.subtotal || calculateSubtotal(orderData.items);
            const tax = orderData.tax || Math.round(subtotal * 0.18);
            const shipping = orderData.shipping || (subtotal >= 1000 ? 0 : 99);
            const total = orderData.total || (subtotal + tax + shipping);

            document.getElementById('order-subtotal').textContent = `₹${subtotal.toLocaleString('en-IN')}`;
            document.getElementById('order-tax').textContent = `₹${tax.toLocaleString('en-IN')}`;
            document.getElementById('order-shipping').textContent = shipping === 0 ? 'Free' : `₹${shipping.toLocaleString('en-IN')}`;
            document.getElementById('order-total').textContent = `₹${total.toLocaleString('en-IN')}`;

            // Display delivery address
            const addressContainer = document.getElementById('delivery-address');
            
            // Check for address fields (checkout uses 'address', admin uses 'address1')
            const address1 = orderData.address1 || orderData.address;
            const address2 = orderData.address2;
            const city = orderData.city;
            const state = orderData.state;
            const zipCode = orderData.zipCode || orderData.pincode;
            
            if (address1) {
                addressContainer.innerHTML = `
                    <p><strong>${orderData.firstName || ''} ${orderData.lastName || ''}</strong></p>
                    <p>${address1}</p>
                    ${address2 ? `<p>${address2}</p>` : ''}
                    <p>${city || ''}, ${state || ''} ${zipCode || ''}</p>
                    <p><strong>Phone:</strong> ${orderData.phone || 'N/A'}</p>
                `;
            } else {
                addressContainer.innerHTML = `<p>No delivery address provided</p>`;
            }
        }

        function calculateSubtotal(items) {
            if (!items || !items.length) return 0;
            return items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        }

        function calculateDeliveryDate() {
            const today = new Date();
            const deliveryDate = new Date(today.getTime() + (5 * 24 * 60 * 60 * 1000)); // 5 days from now
            document.getElementById('delivery-date').textContent = deliveryDate.toLocaleDateString('en-IN', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // Clear order data after 5 minutes (optional)
        setTimeout(() => {
            localStorage.removeItem('bumableRecentOrder');
            localStorage.removeItem('checkoutCart');
        }, 5 * 60 * 1000);

        // Notifications functionality
        function toggleNotifications() {
            console.log('Notifications clicked');
            // Add your notifications logic here
        }

        // Print order summary function
        function printOrderSummary() {
            // Get the recent order data
            const recentOrder = localStorage.getItem('bumableRecentOrder');
            let orderData = null;
            
            if (recentOrder) {
                orderData = JSON.parse(recentOrder);
            } else {
                // Fallback to checkout data
                const checkoutData = localStorage.getItem('checkoutCart');
                if (checkoutData) {
                    orderData = JSON.parse(checkoutData);
                } else {
                    alert('No order data found to print!');
                    return;
                }
            }

            // Create print window
            const printWindow = window.open('', '_blank', 'width=800,height=1000');
            
            // Get customer information
            const customerName = `${orderData.firstName || ''} ${orderData.lastName || ''}`.trim() || 'Customer';
            const customerEmail = orderData.email || 'N/A';
            const customerPhone = orderData.phone || 'N/A';
            
            // Check for address fields (checkout uses 'address', admin uses 'address1')
            const address1 = orderData.address1 || orderData.address;
            const address2 = orderData.address2;
            const city = orderData.city;
            const state = orderData.state;
            const zipCode = orderData.zipCode || orderData.pincode;
            
            const address = address1 
                ? `${address1}${address2 ? ', ' + address2 : ''}, ${city || ''}, ${state || ''} ${zipCode || ''}`
                : 'No address provided';

            const orderDate = new Date(orderData.orderDate || Date.now()).toLocaleDateString('en-IN', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            // Create items table
            const itemsTableRows = orderData.items ? orderData.items.map(item => `
                <tr style="border-bottom: 1px solid #ddd;">
                    <td style="padding: 10px; text-align: left;">${item.name || 'Product'}</td>
                    <td style="padding: 10px; text-align: center;">${item.size || 'M'}</td>
                    <td style="padding: 10px; text-align: center;">${item.quantity || 1}</td>
                    <td style="padding: 10px; text-align: right;">₹${(item.price || 0).toLocaleString('en-IN')}</td>
                    <td style="padding: 10px; text-align: right;">₹${((item.price || 0) * (item.quantity || 1)).toLocaleString('en-IN')}</td>
                </tr>
            `).join('') : '<tr><td colspan="5" style="text-align: center; padding: 20px;">No items found</td></tr>';

            // Calculate delivery date
            const deliveryDate = new Date();
            deliveryDate.setDate(deliveryDate.getDate() + 5);

            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Order Summary - ${orderData.orderId || 'ORDER'}</title>
                    <style>
                        body { 
                            font-family: 'Arial', sans-serif; 
                            margin: 20px; 
                            color: #333; 
                            line-height: 1.6;
                        }
                        .header { 
                            text-align: center; 
                            border-bottom: 3px solid #097969; 
                            padding-bottom: 20px; 
                            margin-bottom: 30px; 
                        }
                        .header h1 { 
                            color: #097969; 
                            margin: 0; 
                            font-size: 32px; 
                            font-weight: bold;
                        }
                        .header .company-info { 
                            margin-top: 8px; 
                            color: #666; 
                            font-size: 16px; 
                        }
                        .success-message {
                            background: #d4edda;
                            color: #155724;
                            padding: 15px;
                            border-radius: 8px;
                            margin-bottom: 20px;
                            text-align: center;
                            border: 1px solid #c3e6cb;
                        }
                        .section { 
                            margin-bottom: 25px; 
                        }
                        .section h2 { 
                            color: #097969; 
                            border-bottom: 2px solid #ddd; 
                            padding-bottom: 8px; 
                            margin-bottom: 15px; 
                            font-size: 20px; 
                        }
                        .info-row { 
                            display: flex; 
                            justify-content: space-between; 
                            margin-bottom: 8px; 
                            padding: 8px 0; 
                        }
                        .info-row strong {
                            color: #333;
                        }
                        .total-row { 
                            border-top: 2px solid #ddd; 
                            font-weight: bold; 
                            font-size: 18px; 
                            margin-top: 15px; 
                            padding-top: 15px; 
                            color: #097969;
                        }
                        .items-table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin-top: 15px; 
                        }
                        .items-table th { 
                            background-color: #097969; 
                            color: white; 
                            font-weight: bold; 
                            padding: 12px 10px; 
                            text-align: left;
                        }
                        .items-table td { 
                            padding: 10px; 
                            border-bottom: 1px solid #ddd; 
                        }
                        .delivery-info {
                            background: #f8f9fa;
                            padding: 15px;
                            border-radius: 8px;
                            border-left: 4px solid #097969;
                        }
                        .footer {
                            margin-top: 30px;
                            text-align: center;
                            color: #666;
                            font-size: 14px;
                            border-top: 1px solid #ddd;
                            padding-top: 20px;
                        }
                        @media print {
                            body { margin: 0; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>BUMABLE</h1>
                        <div class="company-info">Premium Clothing Store</div>
                        <div class="company-info">Order Confirmation</div>
                    </div>

                    <div class="success-message">
                        <h2 style="margin: 0; color: #155724;">✓ Order Confirmed!</h2>
                        <p style="margin: 8px 0 0 0;">Thank you for your purchase. Your order has been successfully placed.</p>
                    </div>

                    <div class="section">
                        <h2>Order Information</h2>
                        <div class="info-row">
                            <span><strong>Order ID:</strong></span>
                            <span>${orderData.orderId || 'N/A'}</span>
                        </div>
                        <div class="info-row">
                            <span><strong>Order Date:</strong></span>
                            <span>${orderDate}</span>
                        </div>
                        <div class="info-row">
                            <span><strong>Payment Method:</strong></span>
                            <span>${orderData.payment || 'Cash on Delivery'}</span>
                        </div>
                        <div class="info-row">
                            <span><strong>Order Status:</strong></span>
                            <span>Confirmed</span>
                        </div>
                    </div>

                    <div class="section">
                        <h2>Customer Details</h2>
                        <div class="info-row">
                            <span><strong>Name:</strong></span>
                            <span>${customerName}</span>
                        </div>
                        <div class="info-row">
                            <span><strong>Email:</strong></span>
                            <span>${customerEmail}</span>
                        </div>
                        <div class="info-row">
                            <span><strong>Phone:</strong></span>
                            <span>${customerPhone}</span>
                        </div>
                        <div class="info-row">
                            <span><strong>Delivery Address:</strong></span>
                            <span>${address}</span>
                        </div>
                    </div>

                    <div class="section">
                        <h2>Order Items</h2>
                        <table class="items-table">
                            <thead>
                                <tr>
                                    <th style="text-align: left;">Product</th>
                                    <th style="text-align: center;">Size</th>
                                    <th style="text-align: center;">Qty</th>
                                    <th style="text-align: right;">Price</th>
                                    <th style="text-align: right;">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${itemsTableRows}
                            </tbody>
                        </table>
                    </div>

                    <div class="section">
                        <h2>Order Summary</h2>
                        <div class="info-row">
                            <span>Subtotal:</span>
                            <span>₹${(orderData.subtotal || 0).toLocaleString('en-IN')}</span>
                        </div>
                        <div class="info-row">
                            <span>Tax (GST 18%):</span>
                            <span>₹${(orderData.tax || 0).toLocaleString('en-IN')}</span>
                        </div>
                        <div class="info-row">
                            <span>Shipping:</span>
                            <span>₹${(orderData.shipping || 0).toLocaleString('en-IN')}</span>
                        </div>
                        <div class="info-row total-row">
                            <span><strong>Total Amount:</strong></span>
                            <span><strong>₹${(orderData.total || 0).toLocaleString('en-IN')}</strong></span>
                        </div>
                    </div>

                    <div class="section">
                        <div class="delivery-info">
                            <h3 style="color: #097969; margin-top: 0;"><i class="fas fa-truck"></i> Delivery Information</h3>
                            <p><strong>Estimated Delivery:</strong> ${deliveryDate.toLocaleDateString('en-IN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                            <p><strong>Tracking:</strong> You will receive tracking information via email once your order ships.</p>
                        </div>
                    </div>

                    <div class="footer">
                        <p>Thank you for choosing BUMABLE!</p>
                        <p>For any queries, contact us at support@bumable.com</p>
                    </div>

                    <scr` + `ipt>
                        window.onload = function() {
                            window.print();
                            window.onafterprint = function() {
                                window.close();
                            };
                        };
                    </scr` + `ipt>
                </body>
                </html>
            `;

            printWindow.document.write(printContent);
            printWindow.document.close();
        }

        // Mobile navigation toggle
        const navToggle = document.getElementById('nav-toggle');
        const navMenu = document.getElementById('nav-menu');

        if (navToggle) {
            navToggle.addEventListener('click', () => {
                navMenu.classList.toggle('nav-menu-active');
                navToggle.classList.toggle('nav-toggle-active');
            });
        }
    </script>
</body>
</html>